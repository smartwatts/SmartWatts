# SmartWatts Production Deployment Guide

## üöÄ Quick Start

Deploy SmartWatts to production in minutes:

```bash
# Clone the repository
git clone https://github.com/your-org/mySmartWatts.git
cd mySmartWatts

# Run quick start script
./scripts/quick-start-production.sh mysmartwatts.com admin@mysmartwatts.com
```

## üìã Prerequisites

### System Requirements
- **OS**: Ubuntu 20.04+ / CentOS 8+ / RHEL 8+
- **RAM**: 8GB minimum, 16GB recommended
- **CPU**: 4 cores minimum, 8 cores recommended
- **Storage**: 100GB SSD minimum
- **Network**: Public IP with domain name

### Software Requirements
- Docker 20.10+
- Docker Compose 2.0+
- Git
- curl/wget
- k6 (for load testing)

## üîß Installation

### 1. SSL/TLS Certificates

#### Development (Self-Signed)
```bash
./scripts/generate-ssl-certs.sh
```

#### Production (Let's Encrypt)
```bash
# Certificates will be automatically generated by certbot
# Ensure your domain points to this server's IP
```

### 2. Load Balancer Configuration

Nginx is configured with:
- SSL termination
- Load balancing across services
- Health checks
- Rate limiting
- Security headers

**Configuration**: `nginx/nginx.conf`

### 3. Monitoring Stack

#### Prometheus
- **URL**: http://localhost:9090
- **Purpose**: Metrics collection and alerting
- **Configuration**: `monitoring/prometheus.yml`

#### Grafana
- **URL**: http://localhost:3001
- **Username**: admin
- **Password**: smartwatts2024
- **Purpose**: Dashboards and visualization

#### Alertmanager
- **URL**: http://localhost:9093
- **Purpose**: Alert routing and notifications

### 4. Load Testing

Comprehensive load testing with k6:

```bash
cd load-testing
./run-load-tests.sh
```

**Test Scenarios**:
- Basic Load Test (50 users)
- Stress Test (200 users)
- Spike Test (sudden traffic spikes)
- Soak Test (sustained load)

## üåê Service Architecture

### Backend Services (11 Microservices)
- **API Gateway** (Port 8080) - Request routing and authentication
- **User Service** (Port 8081) - User management and authentication
- **Energy Service** (Port 8082) - Energy data collection
- **Analytics Service** (Port 8084) - Data analysis and insights
- **Device Service** (Port 8083) - IoT device management
- **Billing Service** (Port 8085) - Financial management
- **Appliance Monitoring** (Port 8087) - Smart appliance monitoring
- **Edge Gateway** (Port 8088) - Edge computing and local processing
- **Device Verification** (Port 8091) - Device authentication
- **Feature Flag Service** (Port 8090) - Feature management
- **API Documentation** (Port 8086) - API documentation

### Infrastructure Services
- **PostgreSQL** (Port 5432) - Primary database
- **Redis** (Port 6379) - Caching and session storage
- **Eureka** (Port 8761) - Service discovery
- **Nginx** (Ports 80, 443) - Load balancer and SSL termination

### Frontend
- **Next.js Application** (Port 3000) - User interface

## üîê Security Features

### SSL/TLS
- TLS 1.2 and 1.3 support
- Strong cipher suites
- HSTS headers
- Certificate auto-renewal

### Security Headers
- X-Frame-Options: DENY
- X-Content-Type-Options: nosniff
- X-XSS-Protection: 1; mode=block
- Content-Security-Policy
- Referrer-Policy

### Rate Limiting
- API endpoints: 10 requests/second
- Login endpoints: 5 requests/minute
- Burst handling with nodelay

### Authentication
- JWT tokens with refresh mechanism
- Role-based access control (RBAC)
- OAuth2 resource server integration

## üìä Monitoring & Alerting

### Key Metrics
- **Response Time**: < 200ms (95th percentile)
- **Error Rate**: < 1%
- **Availability**: 99.5% uptime
- **Throughput**: 1000+ requests/second

### Alerts
- Service down alerts
- High error rate alerts
- High response time alerts
- Resource usage alerts
- Business metric alerts

### Dashboards
- System Overview
- Service Health
- Performance Metrics
- Business Intelligence
- Infrastructure Monitoring

## üöÄ Deployment Commands

### Full Production Deployment
```bash
./scripts/deploy-production.sh
```

### Individual Components
```bash
# Backend services
cd backend && docker-compose up -d

# Monitoring stack
cd monitoring && docker-compose up -d

# Load balancer
cd nginx && docker-compose up -d

# Frontend
cd frontend && npm run build && npm start
```

### Health Checks
```bash
# Check all services
curl http://localhost:8080/actuator/health

# Check individual services
curl http://localhost:8081/actuator/health  # User Service
curl http://localhost:8082/actuator/health  # Energy Service
curl http://localhost:8084/actuator/health  # Analytics Service
```

## üîß Configuration

### Environment Variables
```bash
# Domain configuration
export DOMAIN=mysmartwatts.com
export EMAIL=admin@mysmartwatts.com

# Database configuration
export POSTGRES_HOST=postgres
export POSTGRES_DB=smartwatts
export POSTGRES_USER=postgres
export POSTGRES_PASSWORD=your-password

# Redis configuration
export REDIS_HOST=redis
export REDIS_PORT=6379
```

### Service Configuration
Each service can be configured via:
- `application.yml` files
- Environment variables
- Docker Compose overrides

## üìà Performance Optimization

### Database Optimization
- Connection pooling
- Query optimization
- Indexing strategy
- Read replicas (for scaling)

### Caching Strategy
- Redis for session storage
- Application-level caching
- CDN for static assets

### Load Balancing
- Round-robin distribution
- Health check integration
- Failover handling
- Session affinity (if needed)

## üîÑ Maintenance

### Backup Strategy
```bash
# Database backup
docker exec postgres pg_dump -U postgres smartwatts > backup.sql

# Configuration backup
tar -czf config-backup.tar.gz nginx/ monitoring/ backend/
```

### Updates
```bash
# Update services
docker-compose pull
docker-compose up -d

# Update frontend
cd frontend && npm update && npm run build
```

### Monitoring
- Check Grafana dashboards daily
- Review Prometheus alerts
- Monitor log files
- Performance metrics analysis

## üÜò Troubleshooting

### Common Issues

#### Services Not Starting
```bash
# Check logs
docker-compose logs [service-name]

# Check resource usage
docker stats

# Restart services
docker-compose restart
```

#### SSL Certificate Issues
```bash
# Check certificate status
openssl x509 -in nginx/ssl/smartwatts.crt -text -noout

# Regenerate certificates
./scripts/generate-ssl-certs.sh
```

#### Database Connection Issues
```bash
# Check database status
docker exec postgres pg_isready

# Check connections
docker exec postgres psql -U postgres -c "SELECT * FROM pg_stat_activity;"
```

### Support
- Check logs in `logs/` directory
- Review Grafana dashboards
- Monitor Prometheus metrics
- Check service health endpoints

## üìû Support & Documentation

- **GitHub**: https://github.com/your-org/mySmartWatts
- **Documentation**: See `README.md` and `FINAL_STATUS.md`
- **API Docs**: http://localhost:8086/swagger-ui.html
- **Monitoring**: http://localhost:3001 (Grafana)

---

**SmartWatts is production-ready!** üéâ

For additional support or questions, please refer to the documentation or contact the development team.
