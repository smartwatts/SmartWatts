server:
  port: 8088

spring:
  application:
    name: edge-gateway
  
  cloud:
    netflix:
      eureka:
        client:
          service-url:
            defaultZone: http://localhost:8761/eureka/
          register-with-eureka: true
          fetch-registry: true
        instance:
          prefer-ip-address: true
          instance-id: ${spring.application.name}:${server.port}

# Facility Integration Configuration
facility:
  service:
    url: http://localhost:8089
  sync:
    interval: 300000  # 5 minutes in milliseconds

# Edge Gateway Configuration
edge:
  ml:
    models:
      sync-interval: 3600000  # 1 hour in milliseconds
      energy_forecast: "models/energy_forecast.tflite"
      anomaly_detection: "models/anomaly_detection.tflite"
      optimization: "models/optimization.tflite"
    inference:
      batch_size: 32
      timeout_ms: 5000
    anomaly:
      threshold: 0.8
    prediction:
      horizon:
        hours: 24
    optimization:
      confidence:
        min: 0.7
  device:
    discovery-interval: 30000  # 30 seconds in milliseconds
  mqtt:
    broker:
      url: tcp://localhost:1883
    client:
      id: smartwatts-edge-${random.uuid}
      clean-session: true
      connection-timeout: 30
      keep-alive-interval: 60
      automatic-reconnect: true

# RS485 Serial Communication Configuration
rs485:
  default-port: "/dev/ttyUSB0"
  default-baud-rate: 9600
  default-data-bits: 8
  default-parity: "NONE"
  default-stop-bits: 1
  read-timeout: 1000
  write-timeout: 1000
  polling-interval: 5000
  auto-discovery: true
  enable-logging: true
  max-retry-attempts: 3
  retry-delay: 1000
  devices:
    # Example inverter configurations
    sma-sunny-boy:
      port: "/dev/ttyUSB0"
      baud-rate: 9600
      data-bits: 8
      parity: "NONE"
      stop-bits: 1
      read-timeout: 1000
      write-timeout: 1000
      unit-id: 1
      start-address: 40000
      register-count: 20
      control-address: 0
      device-type: "SOLAR_INVERTER"
      manufacturer: "SMA"
      model: "Sunny Boy"
      enabled: true
    fronius-symo:
      port: "/dev/ttyUSB1"
      baud-rate: 19200
      data-bits: 8
      parity: "NONE"
      stop-bits: 1
      read-timeout: 1000
      write-timeout: 1000
      unit-id: 1
      start-address: 50000
      register-count: 25
      control-address: 0
      device-type: "SOLAR_INVERTER"
      manufacturer: "Fronius"
      model: "Symo"
      enabled: true
    growatt-sph:
      port: "/dev/ttyUSB2"
      baud-rate: 9600
      data-bits: 8
      parity: "NONE"
      stop-bits: 1
      read-timeout: 1000
      write-timeout: 1000
      unit-id: 1
      start-address: 1000
      register-count: 10
      control-address: 0
      device-type: "SOLAR_INVERTER"
      manufacturer: "Growatt"
      model: "SPH"
      enabled: true

# Security Configuration
smartwatts:
  security:
    device-verification:
      enabled: true
      strict-mode: true
      block-unverified: true
    auth-secret-validation:
      enabled: true
      required: false
      validate-on-ingestion: true
    device-service:
      url: http://localhost:8083
      timeout: 5000
      retry-attempts: 3
    audit:
      log-all-attempts: true
      log-success: true
      log-failures: true

# Logging Configuration
logging:
  level:
    com.smartwatts.edge: INFO
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
